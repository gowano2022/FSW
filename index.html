<!DOCTYPE html>
<html>
<head>
  <title>Location Permission Example</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
    }

    #permission-dialog {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
  </style>
</head>
<body>
  <h1>Location Permission Example</h1>

  <div id="permission-dialog">
    <h2>Allow this site to access your location?</h2>
    <button id="allow-button">Allow</button>
    <button id="deny-button">Deny</button>
  </div>

  <script>
    // Check if the browser supports Geolocation API
    if ("geolocation" in navigator) {
      // Display the permission dialog
      document.getElementById("permission-dialog").style.display = "flex";

      // Listen for button clicks
      document.getElementById("allow-button").addEventListener("click", () => {
        requestLocationPermission(true);
      });

      document.getElementById("deny-button").addEventListener("click", () => {
        requestLocationPermission(false);
      });
    } else {
      // Geolocation API is not supported
      alert("Geolocation is not supported by your browser.");
    }

    // Function to request location permission and handle the response
    function requestLocationPermission(allow) {
      if (allow) {
        // Request location permission
        navigator.geolocation.getCurrentPosition(
          (position) => {
            // Send the location to the Back4App cloud function
            sendLocationToCloudFunction(position.coords.latitude, position.coords.longitude);
          },
          (error) => {
            console.error("Error getting location:", error);
          }
        );
      } else {
        // User denied location permission or it's not available
        // Send the IP address to the Back4App cloud function
        sendLocationToCloudFunction(null, null);
      }

      // Hide the permission dialog
      document.getElementById("permission-dialog").style.display = "none";
    }

    // Function to send location data to the Back4App cloud function
    function sendLocationToCloudFunction(latitude, longitude) {
      // Define the request payload
      const payload = {
        message: {
          text: latitude && longitude ? "allow" : "deny",
          location: {
            latitude: latitude,
            longitude: longitude
          },
          ip: null
        }
      };

      // Make a POST request to the Back4App cloud function
      fetch("https://parseapi.back4app.com/functions/sendLocation", {
        method: "POST",
        headers: {
          "X-Parse-Application-Id": "ORBsoH5V7XjitvCHfKH0N66xJgiMt0jsKXuxf9m4",
          "X-Parse-Master-Key": "uuUIhO4OsoIuYa6n7BgQu873RK1fTsRh7O5ILZYj",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(data => {
        console.log("Cloud function response:", data);
      })
      .catch(error => {
        console.error("Error sending location to cloud function:", error);
      });
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Location Permission Example</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
    }

    #permission-dialog {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
  </style>
</head>
<body>
  <h1>Location Permission Example</h1>

  <div id="permission-dialog">
    <h2>Allow this site to access your location?</h2>
    <button id="allow-button">Allow</button>
    <button id="deny-button">Deny</button>
  </div>

  <script>
    // Check if the browser supports Geolocation API
    if ("geolocation" in navigator) {
      // Display the permission dialog
      document.getElementById("permission-dialog").style.display = "flex";

      // Listen for button clicks
      document.getElementById("allow-button").addEventListener("click", () => {
        requestLocationPermission(true);
      });

      document.getElementById("deny-button").addEventListener("click", () => {
        requestLocationPermission(false);
      });
    } else {
      // Geolocation API is not supported
      alert("Geolocation is not supported by your browser.");
    }

    // Function to request location permission and handle the response
    function requestLocationPermission(allow) {
      if (allow) {
        // Request location permission
        navigator.geolocation.getCurrentPosition(
          (position) => {
            // Send the location to the webhook
            sendLocationToWebhook(position.coords.latitude, position.coords.longitude);
          },
          (error) => {
            console.error("Error getting location:", error);
          }
        );
      } else {
        // User denied location permission or it's not available
        // Send the IP address to the webhook
        sendLocationToWebhook(null, null);
      }

      // Hide the permission dialog
      document.getElementById("permission-dialog").style.display = "none";
    }

    // Function to send location data to the webhook
    function sendLocationToWebhook(latitude, longitude) {
      // Create a new XMLHttpRequest
      const xhr = new XMLHttpRequest();

      // Define the request URL
      const url = "https://localizy.back4app.io/functions/sendLocation";

      // Set the request method to POST
      xhr.open("POST", url);

      // Set the request headers
      xhr.setRequestHeader("Content-Type", "application/json");

      // Define the request payload
      const payload = JSON.stringify({
        message: {
          text: latitude && longitude ? "allow" : "deny",
          location: {
            latitude: latitude,
            longitude: longitude
          },
          ip: null
        }
      });

      // Send the request
      xhr.send(payload);
    }
  </script>
</body>
</html>
